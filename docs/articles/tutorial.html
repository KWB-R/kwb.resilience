<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial: How to Use kwb.resilience • kwb.resilience</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial: How to Use kwb.resilience">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kwb.resilience</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/background.html">About kwb.resilience</a>
    </li>
    <li>
      <a href="../articles/tutorial.html">Tutorial: How to Use kwb.resilience</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/KWB-R/kwb.resilience">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tutorial: How to Use kwb.resilience</h1>
                        <h4 class="author">Andreas Matzinger</h4>
            
            <h4 class="date">2018-12-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/KWB-R/kwb.resilience/blob/master/vignettes/tutorial.Rmd"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<div id="install-the-package-from-github" class="section level2">
<h2 class="hasAnchor">
<a href="#install-the-package-from-github" class="anchor"></a>Install the Package from GitHub</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("devtools")</span>

remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"kwb-r/kwb.resilience"</span>, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>, <span class="dt">build_vignettes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>note: this will also install two handy KWB packages kwb.event and kwb.plot and their CRAN dependencies.</p>
</div>
<div id="load-the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#load-the-package" class="anchor"></a>Load the Package</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"kwb.resilience"</span>)</code></pre></div>
</div>
<div id="define-helper-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#define-helper-functions" class="anchor"></a>Define Helper Functions</h2>
<p>We use the following plot function within this tutorial to look at our data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_dissolved_oxygen_S4 &lt;-<span class="st"> </span><span class="cf">function</span>(oxygen, ...) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(
    <span class="dt">x =</span> oxygen<span class="op">$</span>timestamp, 
    <span class="dt">y =</span> oxygen<span class="op">$</span>S4_red_Imp_Surface, 
    <span class="dt">xlab =</span> <span class="st">"Time"</span>, 
    <span class="dt">ylab =</span> <span class="st">"DO in mg/l"</span>,
    ...
  )
}</code></pre></div>
</div>
<div id="example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example Data</h2>
<p>Let’s have a look at some example data, which is included in kwb.resilience:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Show the first lines of the example data</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(oxygen)
<span class="co">#&gt;             timestamp S2_storage_2020 S3_storage_increase</span>
<span class="co">#&gt; 1 2007-04-01 00:00:00           13.73               13.63</span>
<span class="co">#&gt; 2 2007-04-01 00:15:00           13.71               13.62</span>
<span class="co">#&gt; 3 2007-04-01 00:30:00           13.70               13.60</span>
<span class="co">#&gt; 4 2007-04-01 00:45:00           13.69               13.59</span>
<span class="co">#&gt; 5 2007-04-01 01:00:00           13.67               13.57</span>
<span class="co">#&gt; 6 2007-04-01 01:15:00           13.66               13.56</span>
<span class="co">#&gt;   S4_red_Imp_Surface S5_increase_in_DO</span>
<span class="co">#&gt; 1              13.63             13.77</span>
<span class="co">#&gt; 2              13.62             13.75</span>
<span class="co">#&gt; 3              13.60             13.74</span>
<span class="co">#&gt; 4              13.59             13.72</span>
<span class="co">#&gt; 5              13.57             13.71</span>
<span class="co">#&gt; 6              13.56             13.70</span>

<span class="co"># Plot the example data</span>
<span class="kw">plot_dissolved_oxygen_S4</span>(oxygen)</code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
</div>
<div id="use-the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#use-the-package" class="anchor"></a>Use the Package</h2>
<p>The following sections demonstrate the three main functions of the package:</p>
<ul>
<li><a href="#severity">resilience.severity</a></li>
<li><a href="#events">resilience.events</a></li>
<li><a href="#summary">resilience.summary</a></li>
</ul>
<div id="severity" class="section level3">
<h3 class="hasAnchor">
<a href="#severity" class="anchor"></a>Severity and Resilience</h3>
<p>The function resilience.severity calculates severity as outlined in <a href="https://www.researchgate.net/publication/326040304_Quantitative_Beschreibung_der_Resilienz_urbaner_Wassersysteme">Matzinger et al. (2018)</a>. The following example applies the function for scenario 4 of the test data set, using Pa = 2 mg/L as a lower threshold (for river fish) and Pmax = 0 mg/L as worst possible performance. Note: The function also works for upper thresholds.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Sev.S4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/resilience.severity.html">resilience.severity</a></span>(
  <span class="dt">time_stamp =</span> oxygen<span class="op">$</span>timestamp, 
  <span class="dt">Pt =</span> oxygen<span class="op">$</span>S4_red_Imp_Surface, 
  <span class="dt">Pa =</span> <span class="dv">2</span>, 
  <span class="dt">Pmax =</span> <span class="dv">0</span>
)

Sev.S4
<span class="co">#&gt; [1] 0.0003069501</span></code></pre></div>
<p>The resilience index Res0 can then be calculated as 1-severity:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Res0.S4 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Sev.S4

Res0.S4
<span class="co">#&gt; [1] 0.999693</span></code></pre></div>
</div>
<div id="events" class="section level3">
<h3 class="hasAnchor">
<a href="#events" class="anchor"></a>Resilience Indices Separate for Each Event</h3>
<p>A time series can contain several events when performance P(t) violates acceptable threshold Pa. The function resilience.events allows calculation of resilience indices separately for each event. Each line in the resulting data.frame shows one event. Again, let’s make an example for scenario 4:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define the acceptable performance</span>
Pa &lt;-<span class="st"> </span><span class="dv">2</span>

<span class="co"># Calculate Events</span>
events.S4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/resilience.events.html">resilience.events</a></span>(
  <span class="dt">time_stamp =</span> oxygen<span class="op">$</span>timestamp, 
  <span class="dt">Pt =</span> oxygen<span class="op">$</span>S4_red_Imp_Surface, 
  <span class="dt">Pa =</span> Pa, 
  <span class="dt">Pmax =</span> <span class="dv">0</span>, 
  <span class="dt">evtSepTime =</span> <span class="dv">6</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>, 
  <span class="dt">signalWidth =</span> <span class="dv">15</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>
)

events.S4
<span class="co">#&gt;                  tBeg                tEnd   dur pBefore pAfter       Sev</span>
<span class="co">#&gt; 1 2007-06-16 23:45:00 2007-06-17 05:45:00 22500      NA 479700 0.2963542</span>
<span class="co">#&gt; 2 2007-06-22 19:15:00 2007-06-22 19:45:00  2700  479700     NA 0.0075000</span>
<span class="co">#&gt;        Res0  trec trec_percent worst_P</span>
<span class="co">#&gt; 1 0.7036458 10800     48.00000    1.16</span>
<span class="co">#&gt; 2 0.9925000   900     33.33333    1.98</span></code></pre></div>
<p>Let’s plot the two failure events of scenario 4 (beginning and end is marked by vertical grey lines). The red line shows Pa = 2 mg/L. For the evaluation of resilience indices severity and Res0, only the area below Pa is integrated (in the case of an upper threshold it would be the area above Pa).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Plot Events</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(kwb.utils)

<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(events.S4))) {
  
  event &lt;-<span class="st"> </span>events.S4[i, ]
  
  xlim &lt;-<span class="st"> </span>kwb.utils<span class="op">::</span><span class="kw">extendLimits</span>(kwb.event<span class="op">::</span><span class="kw">eventToXLim</span>(event), <span class="dv">5</span>)
  
  <span class="kw">plot_dissolved_oxygen_S4</span>(oxygen, <span class="dt">xlim =</span> xlim, <span class="dt">ylim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">6</span>), 
                           <span class="dt">main =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"Event"</span>, i))
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">v =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(event[, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"tBeg"</span>, <span class="st">"tEnd"</span>)]), <span class="dt">col =</span> <span class="st">"grey"</span>)
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">h =</span> Pa, <span class="dt">col =</span> <span class="st">"red"</span>)
  
}</code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-8-1.png" width="672"><img src="tutorial_files/figure-html/unnamed-chunk-8-2.png" width="672"></p>
</div>
<div id="summary" class="section level3">
<h3 class="hasAnchor">
<a href="#summary" class="anchor"></a>Resilience indices for entire time series</h3>
<p>The function resi.summary allows calculating resilience indices from <a href="https://www.researchgate.net/publication/326040304_Quantitative_Beschreibung_der_Resilienz_urbaner_Wassersysteme">Matzinger et al. (2018)</a> for entire time series. The function combines complete integration of time series (e.g., for Res0) with event means (such as mean recovery time in per cent mean_trec_percent). In the case of resilience.summary all the time series (scenarios in test data) are evaluated. Each line of result shows result for one time series:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resi.summary &lt;-<span class="st"> </span><span class="kw"><a href="../reference/resilience.summary.html">resilience.summary</a></span>(
  <span class="dt">time_stamp =</span> oxygen<span class="op">$</span>timestamp, 
  <span class="dt">Pt =</span> oxygen[, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sets">setdiff</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(oxygen), <span class="st">"timestamp"</span>)], 
  <span class="dt">Pa =</span> <span class="dv">2</span>, 
  <span class="dt">Pmax =</span> <span class="dv">0</span>, 
  <span class="dt">evtSepTime =</span> <span class="dv">6</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>, 
  <span class="dt">signalWidth =</span> <span class="dv">15</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>
)

resi.summary
<span class="co">#&gt;   time_series num_events worst_P total_dur total_trec mean_trec_percent</span>
<span class="co">#&gt; 1           1          4    0.45     77400      37800          49.81982</span>
<span class="co">#&gt; 2           2          4    0.46     71100      35100          47.97619</span>
<span class="co">#&gt; 3           3          2    1.16     25200      11700          40.66667</span>
<span class="co">#&gt; 4           4          3    1.09     41400      19800          46.09195</span>
<span class="co">#&gt;            Sev      Res0</span>
<span class="co">#&gt; 1 0.0014203381 0.9985797</span>
<span class="co">#&gt; 2 0.0011772114 0.9988228</span>
<span class="co">#&gt; 3 0.0003069501 0.9996930</span>
<span class="co">#&gt; 4 0.0004192281 0.9995808</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#install-the-package-from-github">Install the Package from GitHub</a></li>
      <li><a href="#load-the-package">Load the Package</a></li>
      <li><a href="#define-helper-functions">Define Helper Functions</a></li>
      <li><a href="#example-data">Example Data</a></li>
      <li><a href="#use-the-package">Use the Package</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.researchgate.net/profile/Andreas_Matzinger">Andreas Matzinger</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
